#!/bin/sh

# Post-install script for luci-app-zerotier
# This script ensures proper permissions and configuration

# Set executable permissions for helper script
if [ -f "/usr/bin/ztncui-helper" ]; then
    chmod +x /usr/bin/ztncui-helper
fi

# Set executable permissions for init script
if [ -f "/etc/init.d/zerotier" ]; then
    chmod +x /etc/init.d/zerotier
fi

# Ensure configuration directories exist
mkdir -p /etc/config/zero
mkdir -p /var/lib/zerotier-one/moons.d

# Set default controller type if not set
if ! uci -q get zerotier.sample_config.controller_type >/dev/null 2>&1; then
    uci set zerotier.sample_config.controller_type='official'
    uci commit zerotier
fi

# Clear LuCI cache
rm -rf /tmp/luci-*

# Restart LuCI if running
if pidof uhttpd >/dev/null; then
    /etc/init.d/uhttpd restart
fi

echo "luci-app-zerotier installation completed successfully!"
echo "Please access the web interface to configure ZeroTier."